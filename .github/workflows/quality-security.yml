name: Code Quality & Security (VG)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  code-quality:
    name: Code Quality Checks
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install Pylint
      run: pip install pylint
    
    - name: Run Pylint on backend
      run: |
        cd backend
        pylint app.py --fail-under=7.0 || echo "Pylint score below 7.0"
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install ESLint
      run: npm install -g eslint
    
    - name: Run ESLint on frontend
      run: |
        cd frontend
        npx eslint app.js --no-eslintrc --env browser,es6 || echo "ESLint warnings found"

  security-scan:
    name: Security Vulnerability Scan
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        cd backend
        pip install -r requirements.txt
    
    - name: Install pip-audit
      run: pip install pip-audit
    
    - name: Run pip-audit
      run: |
        cd backend
        pip-audit || echo "Security vulnerabilities found"
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Node dependencies
      run: npm install
    
    - name: Run npm audit
      run: npm audit --audit-level=moderate || echo "npm vulnerabilities found"
